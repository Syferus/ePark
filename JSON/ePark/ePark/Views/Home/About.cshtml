<h1>Image cutting demo</h1>

<img id="carPark" src="/WebImages/reference.jpg" hidden>

<h1>Canvas:</h1>
<div class="styles">
    <input class="Button" type="Button" value="Cut Image" onClick="Cut()">
</div>
<div class="styles">
    <canvas id="myCanvas" style="border:1px solid #d3d3d3;"></canvas>
</div>
<div class="styles">
    <canvas id="myCanvas2"></canvas>
</div>

@section scripts
{

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>

        var sp = {};

        $(document).ready(function () {
            $('h1').click(function () {
                GetSpacesUsingAjax();
            });
        });

        function GetSpacesUsingAjax() {
            //$.ajax({
            //    type: 'GET',
            //    url: 'Home/GetSpace/',
            //    success: function(sp) {
            //        $('#id').text(sp.space.SpaceID);
            //        $('#x1').text(sp.space.x1);
            //        $('#y1').text(sp.space.y1);

            //    },
            //    error: function(sp) {
            //        alert('error');
            //    }
            //});
            $.get('/Home/GetSpace/', function (data) {
                sp.id = (data.space.SpaceID);
                sp.x1 = (data.space.x1);
                sp.y1 = (data.space.y1);
                sp.x2 = (data.space.x2);
                sp.y2 = (data.space.y2);
                sp.x3 = (data.space.x3);
                sp.y3 = (data.space.y3);
                sp.x4 = (data.space.x4);
                sp.y4 = (data.space.y4);
            });
        }

        function Cut() {

            var a = { x: sp.x1, y: sp.y1 };
            var b = { x: sp.x2, y: sp.y2 };
            var c = { x: sp.x3, y: sp.y3 };
            var d = { x: sp.x4, y: sp.y4 };

            var points = [];

            points.push(a);
            points.push(b);
            points.push(c);
            points.push(d);

            var img = document.getElementById("carPark");
            var c = document.getElementById("myCanvas2");
            c.height = img.height;
            c.width = img.width;
            var ctx = c.getContext("2d");

            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);

            for (var i = 1; i < points.length; i++) {
                var p = points[i]; //Possble Remove
                ctx.lineTo(points[i].x, points[i].y);
            }

            ctx.closePath();

            ctx.clip();

            ctx.drawImage(img, 0, 0);
        }

        window.onload = function () {
            var img = document.getElementById("carPark");
            var c = document.getElementById("myCanvas");
            c.height = img.height;
            c.width = img.width;
            var ctx = c.getContext("2d");
            ctx.drawImage(img, 0, 0); // destination rectangle
        };
    </script>

}